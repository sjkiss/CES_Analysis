#File to Recode 2004-2011 CES Data 
library(tidyverse)
library(car)
library(labelled)
library(cesdata)
#load data
data("ces0411")

#------------------------------------------------------------------------------
# Gender is the same variable for all elections 2004-11

#recode Gender (GENDER)
look_for(ces0411, "sex")
ces0411$male<-Recode(ces0411$GENDER, "1=1; 5=0")
val_labels(ces0411$male)<-c(Female=0, Male=1)
#checks
val_labels(ces0411$male)
table(ces0411$male)

#------------------------------------------------------------------------------
###Recode 2004 1st

#recode Union Household (ces04_CPS_S6B)
look_for(ces0411, "union")
ces0411$union04<-Recode(ces0411$ces04_CPS_S6B, "1=1; 5=0; else=NA")
val_labels(ces0411$union04)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union04)
table(ces0411$union04)

#recode Union Combined (ces04_CPS_S6A and ces04_CPS_S6B)
ces0411 %>% 
  mutate(union_both04=case_when(
    ces04_CPS_S6A==1 | ces04_CPS_S6B==1 ~ 1,
    ces04_CPS_S6A==5 | ces04_CPS_S6B==5 ~ 0,
    ces04_CPS_S6A==8 | ces04_CPS_S6A==9 ~ NA_real_,
    ces04_CPS_S6B==8 | ces04_CPS_S6A==9 ~ NA_real_,
  ))->ces0411

val_labels(ces0411$union_both04)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union_both04)
table(ces0411$union_both04)

#recode Education (ces04_CPS_S3)
look_for(ces0411, "education")
ces0411$degree04<-Recode(ces0411$ces04_CPS_S3, "9:11=1; 1:8=0; else=NA")
val_labels(ces0411$degree04)<-c(nodegree=0, degree=1)
#checks
val_labels(ces0411$degree04)
table(ces0411$degree04)

#recode Region (ces04_PROVINCE)
look_for(ces0411, "province")
ces0411$region04<-Recode(ces0411$ces04_PROVINCE, "10:13=1; 35=2; 46:59=3; 4=NA; else=NA")
val_labels(ces0411$region04)<-c(Atlantic=1, Ontario=2, West=3)
#checks
val_labels(ces0411$region04)
table(ces0411$region04)

#recode Quebec (ces04_PROVINCE)
look_for(ces0411, "province")
ces0411$quebec04<-Recode(ces0411$ces04_PROVINCE, "10:13=0; 35:59=0; 24=1; else=NA")
val_labels(ces0411$quebec04)<-c(Other=0, Quebec=1)
#checks
val_labels(ces0411$quebec04)
table(ces0411$quebec04)

#recode Age (YEARofBIRTH)
look_for(ces0411, "birth")
#provide easy to use survey variable
ces0411$survey<-as_factor(ces0411$Survey_Type04060811)
#meake easy to use year of birth variable
ces0411$yob<-Recode(ces0411$YEARofBIRTH, "9998:9999=NA")
#This checks if "04" appears in the survey variable
str_detect(ces0411$survey, "04")
#check
table(str_detect(ces0411$survey, "04"))
#pipe data frame
ces0411 %>% 
  #mutate making new variable age04
  mutate(age04=case_when(
    #if 04 appears in the values for survey then define age-4 as the result of 2004-yob
    str_detect(ces0411$survey, "04")~2004-yob
  ))-> ces0411
#check
table(ces0411$age04)

#recode Religion (ces04_CPS_S9)
look_for(ces0411, "relig")
ces0411$religion04<-Recode(ces0411$ces04_CPS_S9, "0=0; 1:2=2; 4:5=1; 7=2; 9:10=2; 12:14=2; 16:20=2; 98:99=NA; 3=3; 6=3; 8=3; 11=3; 15=3; 97=3;")
val_labels(ces0411$religion04)<-c(None=0, Catholic=1, Protestant=2, Other=3)
#checks
val_labels(ces0411$religion04)
table(ces0411$religion04)

#recode Language (ces04_CPS_S17)
look_for(ces0411, "language")
ces0411$language04<-Recode(ces0411$ces04_CPS_S17, "5=0; 1=1; else=NA")
val_labels(ces0411$language04)<-c(French=0, English=1)
#checks
val_labels(ces0411$language04)
table(ces0411$language04)

#recode Employment (ces04_CPS_S4)
look_for(ces0411, "employed")
ces0411$employment04<-Recode(ces0411$ces04_CPS_S4, "3:7=0; 1:2=1; 8:11=1; else=NA")
val_labels(ces0411$employment04)<-c(Unemployed=0, Employed=1)
#checks
val_labels(ces0411$employment04)
table(ces0411$employment04)

#recode Sector (ces04_CPS_S5)
look_for(ces0411, "self-employed")
ces0411$sector04<-Recode(ces0411$ces04_CPS_S5, "5=1; 0:1=0; else=NA")
val_labels(ces0411$sector04)<-c(Private=0, Public=1)
#checks
val_labels(ces0411$sector04)
table(ces0411$sector04)

#recode Party ID (ces04_CPS_Q1A@3 and ces04_CPS_Q1B@3`) ***note needs `...` to recognize the variable***
look_for(ces0411, "yourself")
ces0411 %>% 
  mutate(party_id04=case_when(
    `ces04_CPS_Q1A@3`==1 | `ces04_CPS_Q1B@3`==1 ~ 1,
    `ces04_CPS_Q1A@3`==2 | `ces04_CPS_Q1B@3`==2 ~ 2,
    `ces04_CPS_Q1A@3`==3 | `ces04_CPS_Q1B@3`==3 ~ 3,
    `ces04_CPS_Q1A@3`==5 | `ces04_CPS_Q1B@3`==5 ~ 2,
    `ces04_CPS_Q1A@3`==0 | `ces04_CPS_Q1B@3`==0 ~ 0,
    `ces04_CPS_Q1A@3`==6 | `ces04_CPS_Q1B@3`==6 ~ 2,
    `ces04_CPS_Q1A@3`==8 | `ces04_CPS_Q1B@3`==8 ~ 0,
    `ces04_CPS_Q1A@3`==4 | `ces04_CPS_Q1B@3`==4 ~ 0,
  ))->ces0411

val_labels(ces0411$party_id04)<-c(Other=0, Liberal=1, Conservative=2, NDP=3)
#checks
val_labels(ces0411$party_id04)
table(ces0411$party_id04)

#recode Vote (ces04_PES_A3@3') ***note needs `...`` to recognize the variable***
look_for(ces0411, "party did you vote")
ces0411$vote04<-Recode(ces0411$`ces04_PES_A3@3`, "1=1; 2=2; 3=3; 4=4; 8=5; 6=2; 10=0; 0=0; else=NA")
val_labels(ces0411$vote04)<-c(Other=0, Liberal=1, Conservative=2, NDP=3, Bloc=4, Green=5)
#checks
val_labels(ces0411$vote04)
table(ces0411$vote04)

#recode Occupation (ces04_PINPORR)
look_for(ces0411, "occupation")
look_for(ces0411, "pinporr")
ces0411$occupation04<-Recode(ces0411$ces04_PINPORR, "1:2:=1; 4:5=1; 3=2; 6:7=2; 9=3; 12=3; 14=3; 8=4; 10=4; 13=4; 15:16=5; else=NA")
val_labels(ces0411$occupation04)<-c(Professional=1, Managers=2, Routine_Nonmanual=3, Skilled=4, Unskilled=5)
#checks
val_labels(ces0411$occupation04)
table(ces0411$occupation04)

#recode Income (ces04_CPS_S18)
look_for(ces0411, "income")
ces0411$income04<-Recode(ces0411$ces04_CPS_S18, "1=1; 2:3=2; 4:5=3; 6:7=4; 8:10=5; else=NA")
val_labels(ces0411$income04)<-c(Lowest=1, Lower_Middle=2, MIddle=3, Upper_Middle=4, Highest=5)
#checks
val_labels(ces0411$income04)
table(ces0411$income04)

#----------------------------------------------------------------------------
###Recode 2006 2nd

# Gender done at top

#recode Union Household (ces06_CPS_S6B)
look_for(ces0411, "union")
ces0411$union06<-Recode(ces0411$ces06_CPS_S6B, "1=1; 5=0; else=NA")
val_labels(ces0411$union06)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union06)
table(ces0411$union06)

#recode Union Combined (ces06_CPS_S6A and ces06_CPS_S6B)
ces0411 %>% 
  mutate(union_both06=case_when(
    ces06_CPS_S6A==1 | ces06_CPS_S6B==1 ~ 1,
    ces06_CPS_S6A==5 | ces06_CPS_S6B==5 ~ 0,
    ces06_CPS_S6A==8 | ces06_CPS_S6A==9 ~ NA_real_,
    ces06_CPS_S6B==8 | ces06_CPS_S6A==9 ~ NA_real_,
  ))->ces0411

val_labels(ces0411$union_both06)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union_both06)
table(ces0411$union_both06)

#recode Education (ces06_CPS_S3)
look_for(ces0411, "education")
ces0411$degree06<-Recode(ces0411$ces06_CPS_S3, "9:11=1; 1:8=0; else=NA")
val_labels(ces0411$degree06)<-c(nodegree=0, degree=1)
#checks
val_labels(ces0411$degree06)
table(ces0411$degree06)

#recode Region (ces06_PROVINCE)
look_for(ces0411, "province")
ces0411$region06<-Recode(ces0411$ces06_PROVINCE, "10:13=1; 35=2; 46:59=3; 4=NA; else=NA")
val_labels(ces0411$region06)<-c(Atlantic=1, Ontario=2, West=3)
#checks
val_labels(ces0411$region06)
table(ces0411$region06)

#recode Quebec (ces06_PROVINCE)
look_for(ces0411, "province")
ces0411$quebec06<-Recode(ces0411$ces06_PROVINCE, "10:13=0; 35:59=0; 24=1; else=NA")
val_labels(ces0411$quebec06)<-c(Other=0, Quebec=1)
#checks
val_labels(ces0411$quebec06)
table(ces0411$quebec06)

#recode Age (YEARofBIRTH)
table(str_detect(ces0411$survey, "06"))
#pipe data frame
ces0411 %>% 
  #mutate making new variable age06
  mutate(age06=case_when(
    str_detect(ces0411$survey, "06")~2006-yob
    #dump in a test dataframe
  ))-> ces0411
#check
table(ces0411$age06)

#recode Religion (ces06_CPS_S9)
look_for(ces0411, "relig")
ces0411$religion06<-Recode(ces0411$ces06_CPS_S9, "0=0; 1:2=2; 4:5=1; 7=2; 9:10=2; 12:14=2; 16:21=2; 98:99=NA; 3=3; 6=3; 8=3; 11=3; 15=3; 97=3;")
val_labels(ces0411$religion06)<-c(None=0, Catholic=1, Protestant=2, Other=3)
#checks
val_labels(ces0411$religion06)
table(ces0411$religion06)

#recode Language (ces06_CPS_S17)
look_for(ces0411, "language")
ces0411$language06<-Recode(ces0411$ces06_CPS_S17, "5=0; 1=1; else=NA")
val_labels(ces0411$language06)<-c(French=0, English=1)
#checks
val_labels(ces0411$language06)
table(ces0411$language06)

#recode Employment (ces06_CPS_S4)
look_for(ces0411, "employed")
ces0411$employment06<-Recode(ces0411$ces06_CPS_S4, "3:7=0; 1:2=1; 8:12=1; 13=0; 14:15=1; else=NA")
val_labels(ces0411$employment06)<-c(Unemployed=0, Employed=1)
#checks
val_labels(ces0411$employment06)
table(ces0411$employment06)

#recode Sector (ces06_CPS_S5)
look_for(ces0411, "self-employed")
ces0411$sector06<-Recode(ces0411$ces06_CPS_S5, "5=1; 0:1=0; else=NA")
val_labels(ces0411$sector06)<-c(Private=0, Public=1)
#checks
val_labels(ces0411$sector06)
table(ces0411$sector06)

#recode Party ID (ces06_CPS_Q1A and ces06_CPS_Q1B)
look_for(ces0411, "yourself")
ces0411 %>% 
  mutate(party_id06=case_when(
    ces06_CPS_Q1A==1 | ces06_CPS_Q1B==1 ~ 1,
    ces06_CPS_Q1A==2 | ces06_CPS_Q1B==2 ~ 2,
    ces06_CPS_Q1A==3 | ces06_CPS_Q1B==3 ~ 3,
    ces06_CPS_Q1A==5 | ces06_CPS_Q1B==5 ~ 0,
    ces06_CPS_Q1A==0 | ces06_CPS_Q1B==0 ~ 0,
    ces06_CPS_Q1A==4 | ces06_CPS_Q1B==4 ~ 0,
    ces06_CPS_Q1A==9 | ces06_CPS_Q1B==9 ~ 0,
  ))->ces0411

val_labels(ces0411$party_id06)<-c(Other=0, Liberal=1, Conservative=2, NDP=3)
#checks
val_labels(ces0411$party_id06)
table(ces0411$party_id06)

#recode Vote (ces06_PES_B4A and ces06_PES_B4B) 
look_for(ces0411, "party did you vote")
ces0411 %>% 
  mutate(vote06=case_when(
    ces06_PES_B4A==1 | ces06_PES_B4B==1 ~ 1,
    ces06_PES_B4A==2 | ces06_PES_B4B==2 ~ 2,
    ces06_PES_B4A==3 | ces06_PES_B4B==3 ~ 3,
    ces06_PES_B4A==5 | ces06_PES_B4B==5 ~ 0,
    ces06_PES_B4A==0 | ces06_PES_B4B==0 ~ 0,
    ces06_PES_B4A==4 | ces06_PES_B4B==4 ~ 0,
  ))->ces0411

val_labels(ces0411$vote06)<-c(Other=0, Liberal=1, Conservative=2, NDP=3, Bloc=4, Green=5)
#checks
val_labels(ces0411$vote06)
table(ces0411$vote06)

#recode Occupation (ces06_PES_SD3)
look_for(ces0411, "occupation")
ces0411$occupation06<-Recode(ces0411$ces06_PES_SD3, "1:1000=2; 1100:1199=1; 2100:3300=1; 4100:6300=1; 1200:1500=3; 6400:6700=3; 3400:3500=3; 7200:7399=4; 7400:7700=5; 8200:8399=4; 8400:8700=5; 9200:9599=4; 9600:9700=5; else=NA")
val_labels(ces0411$occupation06)<-c(Professional=1, Managers=2, Routine_Nonmanual=3, Skilled=4, Unskilled=5)
#checks
val_labels(ces0411$occupation06)
table(ces0411$occupation06)

#recode Income (ces06_CPS_S18)
look_for(ces0411, "income")
ces0411$income06<-Recode(ces0411$ces06_CPS_S18, "1=1; 2:3=2; 4:5=3; 6:9=4; 10=5; else=NA")
val_labels(ces0411$income06)<-c(Lowest=1, Lower_Middle=2, MIddle=3, Upper_Middle=4, Highest=5)
#checks
val_labels(ces0411$income06)
table(ces0411$income06)

#----------------------------------------------------------------------------
###Recode 2008 3rd

# Gender done at top

#recode Union Household (ces08_CPS_S6B)
look_for(ces0411, "union")
ces0411$union08<-Recode(ces0411$ces08_CPS_S6B, "1=1; 5=0; else=NA")
val_labels(ces0411$union08)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union08)
table(ces0411$union08)

#recode Union Combined (ces08_CPS_S6A and ces08_CPS_S6B)
ces0411 %>% 
  mutate(union_both08=case_when(
    ces08_CPS_S6A==1 | ces08_CPS_S6B==1 ~ 1,
    ces08_CPS_S6A==5 | ces08_CPS_S6B==5 ~ 0,
    ces08_CPS_S6A==8 | ces08_CPS_S6A==9 ~ NA_real_,
    ces08_CPS_S6B==8 | ces08_CPS_S6A==9 ~ NA_real_,
  ))->ces0411

val_labels(ces0411$union_both08)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union_both08)
table(ces0411$union_both08)

#recode Education (ces08_CPS_S3)
look_for(ces0411, "education")
ces0411$degree08<-Recode(ces0411$ces08_CPS_S3, "9:11=1; 1:8=0; else=NA")
val_labels(ces0411$degree08)<-c(nodegree=0, degree=1)
#checks
val_labels(ces0411$degree08)
table(ces0411$degree08)

#recode Region (ces08_PROVINCE)
look_for(ces0411, "province")
ces0411$region08<-Recode(ces0411$ces08_PROVINCE, "10:13=1; 35=2; 46:59=3; 4=NA; else=NA")
val_labels(ces0411$region08)<-c(Atlantic=1, Ontario=2, West=3)
#checks
val_labels(ces0411$region08)
table(ces0411$region08)

#recode Quebec (ces08_PROVINCE)
look_for(ces0411, "province")
ces0411$quebec08<-Recode(ces0411$ces08_PROVINCE, "10:13=0; 35:59=0; 24=1; else=NA")
val_labels(ces0411$quebec08)<-c(Other=0, Quebec=1)
#checks
val_labels(ces0411$quebec08)
table(ces0411$quebec08)

#recode Age (YEARofBIRTH)
table(str_detect(ces0411$survey, "08"))
#pipe data frame
ces0411 %>% 
  #mutate making new variable age08
  mutate(age08=case_when(
    str_detect(ces0411$survey, "08")~2008-yob
    #dump in a test dataframe
  ))-> ces0411
#check
table(ces0411$age08)

#recode Religion (ces08_CPS_S9)
look_for(ces0411, "relig")
ces0411$religion08<-Recode(ces0411$ces08_CPS_S9, "0=0; 1:2=2; 4:5=1; 7=2; 9:10=2; 12:14=2; 16:20=2; 98:99=NA; 3=3; 6=3; 8=3; 11=3; 15=3; 97=3;")
val_labels(ces0411$religion08)<-c(None=0, Catholic=1, Protestant=2, Other=3)
#checks
val_labels(ces0411$religion08)
table(ces0411$religion08)

#recode Language (ces08_CPS_S17)
look_for(ces0411, "language")
ces0411$language08<-Recode(ces0411$ces08_CPS_S17, "5=0; 1=1; else=NA")
val_labels(ces0411$language08)<-c(French=0, English=1)
#checks
val_labels(ces0411$language08)
table(ces0411$language08)

#recode Employment (ces08_CPS_S4)
look_for(ces0411, "employed")
ces0411$employment08<-Recode(ces0411$ces08_CPS_S4, "3:7=0; 1:2=1; 8:11=1; else=NA")
val_labels(ces0411$employment08)<-c(Unemployed=0, Employed=1)
#checks
val_labels(ces0411$employment08)
table(ces0411$employment08)

#recode Sector (ces08_CPS_S5)
look_for(ces0411, "self-employed")
ces0411$sector08<-Recode(ces0411$ces08_CPS_S5, "5=1; 0:1=0; else=NA")
val_labels(ces0411$sector08)<-c(Private=0, Public=1)
#checks
val_labels(ces0411$sector08)
table(ces0411$sector08)

#recode Party ID (ces08_PES_K1)
look_for(ces0411, "yourself")
ces0411$party_id08<-Recode(ces0411$ces08_PES_K1, "1=1; 2=2; 3=3; 4:5=0; 0=0; else=NA")
val_labels(ces0411$party_id08)<-c(Other=0, Liberal=1, Conservative=2, NDP=3)
#checks
val_labels(ces0411$party_id08)
table(ces0411$party_id08)

#recode Vote (ces08_PES_B4B) 
look_for(ces0411, "party did you vote")
ces0411$vote08<-Recode(ces0411$ces08_PES_B4B, "1=1; 2=2; 3=3; 4=4; 5=5; 0=0; else=NA")
val_labels(ces0411$vote08)<-c(Other=0, Liberal=1, Conservative=2, NDP=3, Bloc=4, Green=5)
#checks
val_labels(ces0411$vote08)
table(ces0411$vote08)

#recode Occupation (ces08_PES_S3_NOCS)
look_for(ces0411, "occupation")
ces0411$occupation08<-Recode(ces0411$ces08_PES_S3_NOCS, "1:1000=2; 1100:1199=1; 2100:3300=1; 4100:6300=1; 1200:1500=3; 6400:6700=3; 3400:3500=3; 7200:7399=4; 7400:7700=5; 8200:8399=4; 8400:8700=5; 9200:9599=4; 9600:9700=5; else=NA")
val_labels(ces0411$occupation08)<-c(Professional=1, Managers=2, Routine_Nonmanual=3, Skilled=4, Unskilled=5)
#checks
val_labels(ces0411$occupation08)
table(ces0411$occupation08)

#recode Income (ces08_CPS_S18A, ces08_CPS_S18B, ces08_PES_S9A, ces08_PES_S9B)
look_for(ces0411, "income")
ces0411 %>% 
  mutate(income08=case_when(
    ces08_CPS_S18B==1 | ces08_CPS_S18A> -1 & ces08_CPS_S18A < 30 | ces08_PES_S9B==1 | ces08_PES_S9A> -1 & ces08_PES_S9A < 30 ~ 1,
    ces08_CPS_S18B==2 | ces08_CPS_S18A> -1 & ces08_CPS_S18A < 30 | ces08_PES_S9B==2 | ces08_PES_S9A> -1 & ces08_PES_S9A < 30 ~ 1,
    ces08_CPS_S18B==3 | ces08_CPS_S18A> 29 & ces08_CPS_S18A < 50 | ces08_PES_S9B==3 | ces08_PES_S9A> 29 & ces08_PES_S9A < 50 ~ 2,
    ces08_CPS_S18B==4 | ces08_CPS_S18A> 29 & ces08_CPS_S18A < 50 | ces08_PES_S9B==4 | ces08_PES_S9A> 29 & ces08_PES_S9A < 50 ~ 2,
    ces08_CPS_S18B==5 | ces08_CPS_S18A> 49 & ces08_CPS_S18A < 70 | ces08_PES_S9B==5 | ces08_PES_S9A> 49 & ces08_PES_S9A < 70 ~ 3,
    ces08_CPS_S18B==6 | ces08_CPS_S18A> 49 & ces08_CPS_S18A < 70 | ces08_PES_S9B==6 | ces08_PES_S9A> 49 & ces08_PES_S9A < 70 ~ 3,
    ces08_CPS_S18B==7 | ces08_CPS_S18A> 69 & ces08_CPS_S18A < 100 | ces08_PES_S9B==7 | ces08_PES_S9A> 69 & ces08_PES_S9A < 100 ~ 4,
    ces08_CPS_S18B==8 | ces08_CPS_S18A> 69 & ces08_CPS_S18A < 100 | ces08_PES_S9B==8 | ces08_PES_S9A> 69 & ces08_PES_S9A < 100 ~ 4,
    ces08_CPS_S18B==9 | ces08_CPS_S18A> 69 & ces08_CPS_S18A < 100 | ces08_PES_S9B==9 | ces08_PES_S9A> 69 & ces08_PES_S9A < 100 ~ 4,
    ces08_CPS_S18B==10 | ces08_CPS_S18A> 69 & ces08_CPS_S18A < 100 | ces08_PES_S9B==10 | ces08_PES_S9A> 69 & ces08_PES_S9A < 100 ~ 4,
    ces08_CPS_S18B==11 | ces08_CPS_S18A> 99 & ces08_CPS_S18A < 998 | ces08_PES_S9B==11 | ces08_PES_S9A> 99 & ces08_PES_S9A < 998 ~ 5,
    ces08_CPS_S18B==12 | ces08_CPS_S18A> 99 & ces08_CPS_S18A < 998 | ces08_PES_S9B==12 | ces08_PES_S9A> 99 & ces08_PES_S9A < 998 ~ 5,
  ))->ces0411

val_labels(ces0411$income08)<-c(Lowest=1, Lower_Middle=2, MIddle=3, Upper_Middle=4, Highest=5)
#checks
val_labels(ces0411$income08)
table(ces0411$income08)

#----------------------------------------------------------------------------
###Recode 2011 4th

# Gender done at top

#recode Union Household (PES11_94)
look_for(ces0411, "union")
ces0411$union11<-Recode(ces0411$PES11_94, "1=1; 5=0; else=NA")
val_labels(ces0411$union11)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union11)
table(ces0411$union11)

#recode Union Combined (PES11_93 and PES11_94)
ces0411 %>% 
  mutate(union_both11=case_when(
    PES11_93==1 | PES11_94==1 ~ 1,
    PES11_93==5 | PES11_94==5 ~ 0,
    PES11_93==8 | PES11_94==9 ~ NA_real_,
    PES11_93==8 | PES11_94==9 ~ NA_real_,
  ))->ces0411

val_labels(ces0411$union_both11)<-c(None=0, Union=1)
#checks
val_labels(ces0411$union_both11)
table(ces0411$union_both11)

#recode Education (CPS11_79)
look_for(ces0411, "education")
ces0411$degree11<-Recode(ces0411$CPS11_79, "9:11=1; 1:8=0; else=NA")
val_labels(ces0411$degree11)<-c(nodegree=0, degree=1)
#checks
val_labels(ces0411$degree11)
table(ces0411$degree11)

#recode Region (PROVINCE11)
look_for(ces0411, "province")
ces0411$region11<-Recode(ces0411$PROVINCE11, "10:13=1; 35=2; 46:59=3; 4=NA; else=NA")
val_labels(ces0411$region11)<-c(Atlantic=1, Ontario=2, West=3)
#checks
val_labels(ces0411$region11)
table(ces0411$region11)

#recode Quebec (PROVINCE11)
look_for(ces0411, "province")
ces0411$quebec11<-Recode(ces0411$PROVINCE11, "10:13=0; 35:59=0; 24=1; else=NA")
val_labels(ces0411$quebec11)<-c(Other=0, Quebec=1)
#checks
val_labels(ces0411$quebec11)
table(ces0411$quebec11)

#recode Age (YEARofBIRTH)
table(str_detect(ces0411$survey, "11"))
#pipe data frame
ces0411 %>% 
  #mutate making new variable age08
  mutate(age11=case_when(
    str_detect(ces0411$survey, "11")~2011-yob
    #dump in a test dataframe
  ))-> ces0411
#check
table(ces0411$age11)

#recode Religion (CPS11_80)
look_for(ces0411, "relig")
ces0411$religion11<-Recode(ces0411$CPS11_80, "0=0; 1:2=2; 4:5=1; 7=2; 9:10=2; 12:14=2; 16:20=2; 98:99=NA; 3=3; 6=3; 8=3; 11=3; 15=3; 97=3;")
val_labels(ces0411$religion11)<-c(None=0, Catholic=1, Protestant=2, Other=3)
#checks
val_labels(ces0411$religion11)
table(ces0411$religion11)

#recode Language (CPS11_90)
look_for(ces0411, "language")
ces0411$language11<-Recode(ces0411$CPS11_90, "5=0; 1=1; else=NA")
val_labels(ces0411$language11)<-c(French=0, English=1)
#checks
val_labels(ces0411$language11)
table(ces0411$language11)

#recode Employment (CPS11_91)
look_for(ces0411, "employment")
ces0411$employment11<-Recode(ces0411$CPS11_91, "3:7=0; 1:2=1; 8:11=1; else=NA")
val_labels(ces0411$employment11)<-c(Unemployed=0, Employed=1)
#checks
val_labels(ces0411$employment11)
table(ces0411$employment11)

#recode Sector (PES11_92)
look_for(ces0411, "company")
ces0411$sector11<-Recode(ces0411$PES11_92, "5=1; 0:1=0; else=NA")
val_labels(ces0411$sector11)<-c(Private=0, Public=1)
#checks
val_labels(ces0411$sector11)
table(ces0411$sector11)

#recode Party ID (PES11_59a)
look_for(ces0411, "identify")
ces0411$party_id11<-Recode(ces0411$PES11_59a, "1=1; 2=2; 3=3; 4:5=0; 0=0; else=NA")
val_labels(ces0411$party_id11)<-c(Other=0, Liberal=1, Conservative=2, NDP=3)
#checks
val_labels(ces0411$party_id11)
table(ces0411$party_id11)

#recode Vote (PES11_6)
look_for(ces0411, "party did you vote")
ces0411$vote11<-Recode(ces0411$PES11_6, "1=1; 2=2; 3=3; 4=4; 5=5; 0=0; else=NA")
val_labels(ces0411$vote11)<-c(Other=0, Liberal=1, Conservative=2, NDP=3, Bloc=4, Green=5)
#checks
val_labels(ces0411$vote11)
table(ces0411$vote11)

#recode Occupation (NOC_PES11)
look_for(ces0411, "occupation")
class(ces0411$NOC_PES11)
ces0411$occupation11<-Recode(as.numeric(ces0411$NOC_PES11), "1:1000=2; 1100:1199=1; 2100:3300=1; 4100:6300=1; 1200:1500=3; 6400:6700=3; 3400:3500=3; 7200:7399=4; 7400:7700=5; 8200:8399=4; 8400:8700=5; 9200:9599=4; 9600:9700=5; else=NA")
val_labels(ces0411$occupation11)<-c(Professional=1, Managers=2, Routine_Nonmanual=3, Skilled=4, Unskilled=5)
#checks
val_labels(ces0411$occupation11)
table(ces0411$occupation11)

#recode Income (CPS11_92 and CPS11_93)
look_for(ces0411, "income")
ces0411 %>% 
  mutate(income11=case_when(
    CPS11_93==1 | CPS11_92> -1 & CPS11_92 < 30 ~ 1,
    CPS11_93==2 | CPS11_92> 29 & CPS11_92 < 60 ~ 2,
    CPS11_93==3 | CPS11_92> 59 & CPS11_92 < 90 ~ 3,
    CPS11_93==4 | CPS11_92> 89 & CPS11_92 < 110 ~ 4,
    CPS11_93==5 | CPS11_92> 109 & CPS11_92 < 998 ~ 5,
  ))->ces0411

val_labels(ces0411$income11)<-c(Lowest=1, Lower_Middle=2, MIddle=3, Upper_Middle=4, Highest=5)
#checks
val_labels(ces0411$income11)
table(ces0411$income11)
